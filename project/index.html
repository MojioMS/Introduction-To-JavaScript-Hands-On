<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>


<style type="text/css">
	
	html, body { 
        height:100%;
		max-width: 100%;
		overflow-x:hidden;
    }
    #map {
        height:80%;
        border: 2px dashed black;
    }	  
	#mapbottom {
        height:100%;
        border: 2px dashed black;
    }	  
	#bodytopcontainer {
		height:100%;
		padding-bottom: 20px;
	}
	#bodycontainerbottom{
		height:66%;
	}
	#mapcontainer {
		height: 90%;
	}
	#mapcontainerbottom {
		height: 85%;
	}
	.timeContainerAbsolute {
		background:lightblue;
	}
	#sliderabs .slider-track-high, #sliderrel .slider-track-high, #sliderrel .slider-track-low {
		background:yellow;
	}
	#sliderabs .slider-selection {
		background:yellow;
	}
	#sliderabs .slider-tick, #sliderrel .slider-tick {
		background:yellow;
	}
	#sliderrel .slider-tick.in-selection{
		background: lightblue;
	}
	.info-box {
		padding: 5px 5px;
		font: 14px/16px Arial, Helvetica, sans-serif;
		background: white;
		background: rgba(255,255,255,0.8);
		border-radius: 5px;
	}
	.info h4 {
		margin: 0 0 5px;
		color: #777;
	}#legend-top {
		position: relative;
	}#legend-top-max {
		position: absolute;
		right: 0;
	}#legend-top-min {
		position: absolute;
		left: 0;
	}#legend-top-mid {
		position: absolute;
		left: 48%;
	}
/**
	.legend {
		line-height: 18px;
		color: #555;
	}
	.legend i {
		float: left;
		margin-right: 8px;
		opacity: 0.7;
	}*/
	
	
</style>


<link href="bootstrap-slider-master/dependencies/css/bootstrap.min.css" rel="stylesheet">
<link href="bootstrap-slider-master/css/bootstrap-slider.css" rel="stylesheet">
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
<link rel="stylesheet" type="text/css" href="http://www.shieldui.com/shared/components/latest/css/light/all.min.css" />


<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
<script type='text/javascript' src="bootstrap-slider-master/dependencies/js/jquery.min.js"></script>
<script type='text/javascript' src="bootstrap-slider-master/js/bootstrap-slider.js"></script>
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script src="Chart.js-2.0.0-beta/Chart.js-2.0.0-beta/Chart.js" type="text/javascript"></script>


<title>Employees</title>
</head>

<body role="document">
	<!-- Navigation Bar -->
    <nav class="navbar navbar-inverse">
            <div class="navbar-header">
                <a class="navbar-brand" href="" id="date"></a>
            </div>
            <div>
                <ul class="nav navbar-nav"
                	<li></li>
                    <li><a href="">Home</a></li>
                    <li><a href="">About</a></li>
                    <li><a href="">License Information</a></li>
                    <li><a href="">Tutorial</a></li>
                </ul>
        </div>
    </nav> 
   
    <div class="container col-md-5 col-xs-12" id="info-box"><h4>Total employees subject to social insurance contributions in 2012</h4><br /><b>Hover over a district '</b>);</div>
    <div class="container col-md-3 col-xs-12" id="legend-top" style="height:10%; width:"screen.witdh"">
    	<img src="pictures/legend_top_relative.png" style="height:50%; width:100%; opacity:0.7; border:1px solid #333" id="img_legend">
        <p id="legend-top-max"> maximum </p>
        <p id="legend-top-mid"> middle </p>
        <p id="legend-top-min"> 0 </p>
    </div>
    <div class="col-md-5"></div>
    <!-- upper body Container -->
    <div class="row" id="bodytopcontainer">
        
        <!-- Map Container -->
        <div class="panel panel-default col-md-8 col-xs-12" id="mapcontainer">
        	<div class="panel-default" style="height:100%">
            	<div id="map">	</div>
            </div>
        </div>
        <!-- User Interface Container -->
        <div class="panel panel-info col-md-4 col-xs-12" id="UIcontainer">
                <div class="panel-heading">
                	<h3> Data option: </h3>
                </div>
        
                <!-- Selector: District or Subdistricts -->
                <div class="form-group">
                    <label for="sel_topDistrictLevel">Select district level:</label>
                </div>
                <div style="margin: 20px 0px 25px 0px;">
                    <select class="form-control" id="sel_topDistrictLevel" onchange="sel_topDistrictLevel()">
                        <option>Districts</option>
                        <option>Sub-districts</option>
                     </select>
                </div>
                
                <!-- Selector: Total, Male, Female, German, non-german, or  <25years -->
                <div class="form-group">
                    <label for="sel_topCategory">Select data category: </label>
                </div>
                <div style="margin: 20px 0px 25px 0px;">
                    <select class="form-control" id="sel_topCategory" onchange="sel_topCategory()">
                        <option>Total</option>
                        <option>Male</option>
                        <option>Female</option>
                        <option>German</option>
                        <option>non-german</option>
                        <option>younger than 25 years</option>
                     </select>
                </div>
                
                <div>
                    <!-- Radio Buttons: show absolute values OR show changes -->
                    <div class="container">
                        <label for="sel_top_abs_rel">Show...</label>
                        <form role="form" id="sel_top_abs_rel" style="margin: 0px 0px 0px 30px;">
                            <label class="radio">
                                <input type="radio" name="optradio" onclick="timeAbsolute()" checked="checked">...absolute values
                            </label>
                            <label class="radio">
                                <input type="radio" name="optradio" onclick="timeRelative()" >...changes in years
                            </label>
                        </form>
                    </div>
                    
                    <!-- Timeline Selector(s): only one is shown at a time -->
                    <div id="timeContainerAbsolute" style="margin: 50px 0px 25px 30px;">
                         <input id="sliderabs" type="text"/> <!-- absolute timeline: 1 from {2010,2011,2012,2013,2014}-->
                    </div>
                    <div id="timeContainerRelative" style="margin: 50px 0px 25px 30px;">
                         <input id="sliderrel" type="text"/> <!-- relative changes: 2 non-equal from {2010,2011,2012,2013,2014}-->
                    </div>
                </div>
            
            
        </div>
    </div>
    
    <!-- lower body container -->
    <div class="row" style="height: 100%">
    	<div class="col-md-12 col-xs-12 panel panel-primary" id="bodycontainerbottom">
                <div class="panel-heading">
                	<h3> District and Subdistrict Comparision </h3>
                </div>
        <!-- Map Container Bottom-->
        <div class="col-md-5  col-xs-12" id="mapcontainerbottom">
            <div id="mapbottom">	</div>
        </div>
        
        <!-- User Interface Container Bottom -->
        <div class="col-md-2  col-xs-12 panel panel-info" id="UIcontainerbottom">
            <div class="panel-heading">
                <h4> Comparison option: </h4>
            </div>
    
            <!-- Selector: District or Subdistricts -->
            <div class="form-group">
                <label for="sel_botDistrictLevel">Select district level:</label>
            </div>
            <div style="margin: 20px 0px 25px 0px;">
                <select class="form-control" id="sel_botDistrictLevel" onchange="sel_botDistrictLevel()">
                    <option onclick="show_districts()">Districts</option>
                    <option onclick="show_subdistricts()">Sub-districts</option>
                 </select>
            </div>
            
            <!-- Selector: Selection of Districts -->
            <div id="sel_dis">
                <div class="form-group"> 
                    <label for="sel_botDistricts">Select districts by clicking on them at the map or select them from the list below: </label>
                </div>
                <div style="margin: 20px 0px 25px 0px;" >
                    <select multiple class="form-control" id="sel_botDistricts" onchange="sel_botDistricts()">
                        <option>Xmple District 1</option>
                        <option>Xmple District 2</option>
                        <option>unknown</option>
                     </select>
                </div>
            </div>
            
            <!-- Selector: Selection of Subdistricts -->
            <div id="sel_subdis">
                <div class="form-group"> 
                    <label for="sel_botSubdistricts">Select subdistricts by clicking on them at the map or select them from the list below: </label>
                </div>
                <div style="margin: 20px 0px 25px 0px;">
                    <select multiple class="form-control" id="sel_botSubdistricts" onchange="sel_botSubdistricts()">
                        <option>Uppenberg</option>
                        <option>Aaseestadt</option>
                        <option>unknown</option>
                     </select>
                </div>
            </div>
            
            <!-- Selector: Total, Male, Female, German, non-german, or  <25years -->
            <div class="form-group">
                <label for="sel_botCategory">Select data category: </label>
            </div>
            <div style="margin: 20px 0px 25px 0px;">
                <select class="form-control" id="sel_botCategory" onchange="sel_botCategory()">
                    <option>Total</option>
                    <option>Male</option>
                    <option>Female</option>
                    <option>German</option>
                    <option>non-german</option>
                    <option>younger than 25 years</option>
                 </select>
            </div>
        </div>
        
        <!-- detailChart -->
        <div class="col-md-5 col-xs-12 panel">
            <div class="panel panel-info">
                <div class="panel-heading">
                    <h3 id="diagram_title_dis"> Districts in comparison:</h3>
                    <h3 hidden id="diagram_title_subdis"> Subdistricts in comparison: </h3>
                </div>
                <canvas id="myChart"></canvas>
                <div id="legend">
                </div>

        </div>
    </div>
    </div>
  
    
    </div>

</body>

<script>
	
	var data = {
		labels: ["2010", "2011", "2012", "2013", "2014"],
		datasets: [
			{
				label: "Example data Aegidii",
				fill: false,
				backgroundColor: "rgba(70,70,220,0.2)",
				borderColor: "rgba(70,70,220,1)",
				pointBorderColor: "rgba(70,70,220,1)",
				pointBackgroundColor: "#fff",
				pointBorderWidth: 1,
				pointHoverRadius: 5,
				pointHoverBackgroundColor: "rgba(70,70,220,1)",
				pointHoverBorderColor: "rgba(70,70,220,1)",
				pointHoverBorderWidth: 2,
				data: [65, 59, 80, 81, 56]
			},
			{
				label: "Example data Ueberwasser",
				fill: false,
				backgroundColor: "rgba(70,220,60,0.2)",
				borderColor: "rgba(70,220,60,1)",
				pointBorderColor: "rgba(70,220,60,1)",
				pointBackgroundColor: "#fff",
				pointBorderWidth: 1,
				pointHoverRadius: 5,
				pointHoverBackgroundColor: "rgba(70,220,60,1)",
				pointHoverBorderColor: "rgba(70,220,60,1)",
				pointHoverBorderWidth: 2,
				data: [-30, 48, 40, 19, 86]
			},
			{
				label: "Example data Buddenturm",
				fill: false,
				backgroundColor: "rgba(220,70,70,0.2)",
				borderColor: "rgba(220,70,70,1)",
				pointBorderColor: "rgba(220,70,70,1)",
				pointBackgroundColor: "#fff",
				pointBorderWidth: 1,
				pointHoverRadius: 5,
				pointHoverBackgroundColor: "rgba(220,70,70,1)",
				pointHoverBorderColor: "rgba(220,70,70,1)",
				pointHoverBorderWidth: 2,
				data: [61, 28, 46, 39, 53]
			}
			
		]
	};
	
	// Get the context of the canvas element we want to select
	var ctx = document.getElementById("myChart").getContext("2d");
	var myLineChart = new Chart(ctx, { type: 'line', data:data, options: {}});
	document.getElementById("legend").innerHTML = myLineChart.generateLegend();

</script>

<!-- The following Script handles the triggers of the Top map User interfaces and updates the top map visualization -->
<script>

	window.onload = initialise;
	
	var maximum = 2000;
	var ch_maximum = 0;
	var ch_minimum = 0;
	var geoJsonLayer;
	var drawnFirstTime = true;
	var topDataSelection$districtLevel = "districts";
	var	topDataSelection$category = "total";
	var	topDataSelection$dependency = "absolute";
	var	topDataSelection$year = 2012;
	var	topDataSelection$startingYear = 2010;
	var	topDataSelection$endingYear = 2012;
	var botDataSelection$districtLevel = "districts";
	var botDataSelection$category = "total";
	var botDataSelection$comparedDistricts = [];
	var botDataSelection$comparedSubdistricts = [];
	
	/**
	* initialise() sets up the default starting selection when the website in loaded.
	*/
	function initialise(){
		updateTopMap();
		botDataSelection$districtLevel = "districts";
		botDataSelection$category = "total";
		botDataSelection$comparedDistricts = [];
		botDataSelection$comparedSubdistricts = [];
		updateBotMap();
	}
	
	/**
	*  updateTopMap() updates the top map visualization regarding to the chances of the user's selection:
	*/
	function updateTopMap(){
		// TODO: create passing info for selections and forward to calculateMaximValue() and drawToMap()
		if (topDataSelection$dependency == "absolute") {
			calculateMaximumValue();
			console.log("Selected Data for top map:"+topDataSelection$districtLevel+" "+topDataSelection$category+" "+topDataSelection$dependency+" "+topDataSelection$year);} else {
			calculateChanges();
			console.log("Selected Data for top map:"+topDataSelection$districtLevel+" "+topDataSelection$category+" "+topDataSelection$dependency+" "+topDataSelection$startingYear+"-"+topDataSelection$endingYear);}
		
		// TODO: Draw Layer onto map(passing selection information forward):
		drawTopMapLayer();
		info.update();
		//updateLegend();
	}

	// Top Container UI Category Selector:
	function sel_topCategory(){
		var index = document.getElementById("sel_topCategory").selectedIndex;
		// TODO: Show selected category data
		if (index==0){
			topDataSelection$category = "total";
		};
		if (index==1){
			topDataSelection$category = "male";
		};
		if (index==2){
			topDataSelection$category = "female";
		};
		if (index==3){
			topDataSelection$category = "german";
		};
		if (index==4){
			topDataSelection$category = "non_german";
		};
		if (index==5){
			topDataSelection$category = "younger25";
		};
		updateTopMap();
	}

	// Top Container UI District Level Selector:
	function sel_topDistrictLevel(){
		var index = document.getElementById("sel_topDistrictLevel").selectedIndex;
		if (index==0){
			topDataSelection$districtLevel = "districts";
		};
		if (index==1){
			topDataSelection$districtLevel = "subdistricts";
		};
		updateTopMap();
	};	
	
	// Absolute Values selected.
	function timeAbsolute(){
		var dependencyBefore = topDataSelection$dependency;
		$("#timeContainerAbsolute").show();
		$("#timeContainerRelative").hide();
		topDataSelection$dependency = "absolute";
		if (dependencyBefore!=topDataSelection$dependency) { updateTopMap(); }
	}
	
	// Relative Values selected.
	function timeRelative(){
		var dependencyBefore = topDataSelection$dependency;
		$("#timeContainerAbsolute").hide();
		$("#timeContainerRelative").show();
		topDataSelection$dependency = "relative";
		if (dependencyBefore!=topDataSelection$dependency) { updateTopMap(); }
	}

	// Timeslider for absolute values: third party bootstrap input fields:
	var sliderabs = new Slider("#sliderabs", {
		id: "sliderabs",
		value: 2012,
	  	ticks: [2010,2011,2012,2013,2014],
		ticks_labels: ['2010', '2011', '2012', '2013', '2014']
	});
	
	// Select a certain year while showing absolute numbers:
	sliderabs.on("change", function(){
		topDataSelection$year = sliderabs.getValue();
		updateTopMap();
	});
	
	// Timeslider for relative changes: third party bootstrap input fields:
	var sliderrel = new Slider("#sliderrel", {
		id: "sliderrel",
		range:true,
		value: [2010,2012],
	  	ticks: [2010,2011,2012,2013,2014],
		ticks_labels: ['2010', '2011', '2012', '2013', '2014']
	});
	
	// Select a certain start- and ending-year while showing relative changes:
	sliderrel.on("change", function(){
		var startBefore = topDataSelection$startingYear;
		var endingBefore = topDataSelection$endingYear;

		if (sliderrel.getValue()[0] == sliderrel.getValue()[1]) {
			console.log("SLIDER SAME VALUE: " + sliderrel.getValue()[0]);
			sliderrel.setValue([startBefore, startBefore+1]);
			sliderrel._mouseup();
		}
		topDataSelection$startingYear = sliderrel.getValue()[0];
		topDataSelection$endingYear = sliderrel.getValue()[1];
		if ((startBefore != topDataSelection$startingYear) || (endingBefore != topDataSelection$endingYear)) {
			updateTopMap();
		}
	});

</script>

<!-- The following Script handles the triggers of the Bottom map User interfaces and updates the bottom map visualization -->
<script>
	
	/**
	*  updateBotMap() updates the top map visualization regarding to the chances of the user's selection:
	*/
	function updateBotMap(){
		// TODO: Update the map
		//calculateMaximumValue();
		if (botDataSelection$districtLevel=="districts") {
			console.log("Selected Data for bot map:"+botDataSelection$districtLevel+" "+botDataSelection$category+" "+botDataSelection$comparedDistricts);}
		else {
			console.log("Selected Data for bot map:"+botDataSelection$districtLevel+" "+botDataSelection$category+" "+botDataSelection$comparedSubdistricts);}
		drawBotMapLayer();
		updateChart();
	}
	
	// bot Container UI Category Selector:
	function sel_botCategory(){
		var index = document.getElementById("sel_botCategory").selectedIndex;
		if (index==0){
			botDataSelection$category = "total";
		};
		if (index==1){
			botDataSelection$category = "male";
		};
		if (index==2){
			botDataSelection$category = "female";
		};
		if (index==3){
			botDataSelection$category = "german";
		};
		if (index==4){
			botDataSelection$category = "non_german";
		};
		if (index==5){
			botDataSelection$category = "younger25";
		};
		updateBotMap();
	}

	// bot Container UI District Level Selector:
	function sel_botDistrictLevel(){
		var index = document.getElementById("sel_botDistrictLevel").selectedIndex;
		if (index==0){
			botDataSelection$districtLevel = "districts";
			$("#diagram_title_dis").show();
			$("#diagram_title_subdis").hide();
		};
		if (index==1){
			botDataSelection$districtLevel = "subdistricts";
			$("#diagram_title_dis").hide();
			$("#diagram_title_subdis").show();
		};
		updateBotMap();
	};

	// Show only the selection for districts:
	function show_districts(){
		$("#sel_dis").show();
		$("#sel_subdis").hide();
	}
	
	// Show only the selection for subdistricts:
	function show_subdistricts(){
		$("#sel_dis").hide();
		$("#sel_subdis").show();
	}
	
	// Selecting districts to compare them (add a district by clicking instead of ctrl+clicking on it):
	$("#sel_botDistricts").mousedown(function(e){
		e.preventDefault();
		var scroll = this.scrollTop;
		e.target.selected = !e.target.selected;
		this.scrollTop = scroll;
		$(this).focus();
		sel_botDistricts();
	}).mousemove(function(e){e.preventDefault()});
	
	// Change Selection information 
	function sel_botDistricts(){
		var result = [];
		var selector = document.getElementById("sel_botDistricts");
		var options = selector && selector.options;
		for (var i=0, iLen = options.length; i<iLen; i++){
			opt = options[i];
			if (opt.selected) {
				result.push(opt.value || opt.text);
			}
		}
		botDataSelection$comparedDistricts = result;
		updateBotMap();
	}
	
	// Selecting districts to compare them (add a district by clicking instead of ctrl+clicking on it):
	$("#sel_botSubdistricts").mousedown(function(e){
		e.preventDefault();
		var scroll = this.scrollTop;
		e.target.selected = !e.target.selected;
		this.scrollTop = scroll;
		$(this).focus();
		sel_botSubdistricts();
	}).mousemove(function(e){e.preventDefault()});
	
	// Change Selection information
	function sel_botSubdistricts(){
		var result = [];
		var selector = document.getElementById("sel_botSubdistricts");
		var options = selector && selector.options;
		for (var i=0, iLen = options.length; i<iLen; i++){
			opt = options[i];
			if (opt.selected) {
				result.push(opt.value || opt.text);
			}
		}
		botDataSelection$comparedSubdistricts = result;
		updateBotMap();
	}

</script>


<script>

	bounds = new L.LatLngBounds(new L.LatLng(51.815922, 7.314666), new L.LatLng(52.153459, 8.042863));
	var maximum_rounded;
	var map = L.map("map").setView([51.959264, 7.625857], 12).setMaxBounds(bounds);
	var map_bottom = L.map("mapbottom").setView([51.959264, 7.625857], 12).setMaxBounds(bounds);
	map.setZoom(map.getBoundsZoom(bounds,true));
	map_bottom.setZoom(map.getBoundsZoom(bounds,true));
	
	// OSM layer
    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(self.map);
	// OSM layer
    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(self.map_bottom);
		
	
	// Add Custom Information Control:
	var info = L.control();
	info.onAdd = function (map) {
		this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
		this.update();
		return this._div;
	};
	
	// method that we will use to update the control based on feature properties passed
	info.update = function (props) {
		if (topDataSelection$dependency=="absolute") {
			var year = topDataSelection$year - 2010;
			var employees ="<h4>";
			switch (topDataSelection$category) {
				case "total":
					employees = employees + "Total employees subject to social insurance contributions in "+(year+2010) +"</h4>"; break;
				case "male":
					employees = employees + "Male employees subject to social insurance contributions in "+(year+2010)+"</h4>"; break;
				case "female":
					employees = employees + "Female employees subject to social insurance contributions in "+(year+2010)+"</h4>"; break;
				case "german":
					employees = employees + "German employees subject to social insurance contributions in "+(year+2010)+"</h4>"; break;
				case "non_german":
					employees = employees + "Non-german employees subject to social insurance contributions in "+(year+2010)+"</h4>"; break;
				case "younger25":
					employees = employees + "Employees younger than 25 subject to social insurance contributions in "+(year+2010)+"</h4>"; break;
			}
			var info = (props? 
				'<b>' + props.name + '</b><br />' + (topDataSelection$category=="total"? props.total[year] + ' total employees in year ' + (year+2010) 
						  : (topDataSelection$category=="male"? props.male[year] + ' male employees in year ' + (year+2010) 
							: (topDataSelection$category=="female"? props.female[year] + ' female employees in year ' + (year+2010) 
								: (topDataSelection$category=="german"? props.german[year] + ' german employees in year ' + (year+2010) 
									: (topDataSelection$category=="non_german"? props.non_german[year] + ' non-german employees in year ' + (year+2010)  
										: props.younger25[year] + ' employees younger than 25 in year ' + (year+2010) 
									   )
								   )
							   )
							 )
						)
			:"<b> Hover over a district </b><br />.");
		} else {
			var startYear = topDataSelection$startingYear-2010;
			var endYear = topDataSelection$endingYear-2010;
			var change=0;
			var employees = "<h4>";
			switch (topDataSelection$category) {
				case "total": 
					employees = employees + "Changes of total employees subject to social insurance contributions from "+(startYear+2010)+" to "+ (endYear+2010) +"</h4>"; break;
				case "male":
					employees = employees + "Changes of male employees subject to social insurance contributions from "+(startYear+2010)+" to "+ (endYear+2010) +"</h4>"; break;
				case "female":
					employees = employees + "Changes of female employees subject to social insurance contributions from "+(startYear+2010)+" to "+ (endYear+2010) +"</h4>"; break;
				case "german":
					employees = employees + "Changes of german employees subject to social insurance contributions from "+(startYear+2010)+" to "+ (endYear+2010) +"</h4>"; break;
				case "non_german":
					employees = employees + "Changes of non-german employees subject to social insurance contributions from "+(startYear+2010)+" to "+ (endYear+2010) +"</h4>"; break;
				case "younger25":
					employees = employees + "Changes of employees younger than 25 subject to social insurance contributions from "+(startYear+2010)+" to "+ (endYear+2010) +"</h4>"; break;
					
			}
			var info = (props? 
				'<b>' +props.name + '</b><br />' + (topDataSelection$category=="total"? Math.round(1000*props.total[endYear]/props.total[startYear]-1000)/10 + '% change of total employees'				  : (topDataSelection$category=="male"?Math.round(1000* props.male[endYear]/props.male[startYear]-1000)/10 + '% change of male employees'
							: (topDataSelection$category=="female"? Math.round(1000*props.female[endYear]/props.female[startYear]-1000)/10 + '% change of female employees' 
								: (topDataSelection$category=="german"? Math.round(1000*props.german[endYear]/props.german[startYear]-1000)/10 + '% change of german employees'
									: (topDataSelection$category=="non_german"? Math.round(1000*props.non_german[endYear]/props.non_german[startYear]-1000)/10 + '% change of non-german employees'					: Math.round(1000*props.younger25[endYear]/props.younger25[startYear]-1000)/10 + '% change of employees younger than 25'
									   )
								   )
							   )
							 )
						)
			:"<b> Hover over a district </b><br />.");
		}
		
		
		document.getElementById("info-box").innerHTML = employees + info;
		
	};
	
	function rgbToHex(r, g, b) {
		return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
	}
	
	function getColor(value) {
		var color = rgbToHex(0,0,0); // BLACK as indicating an error: will not occur at release ;-)
		if (topDataSelection$dependency == "absolute") {
			var year = topDataSelection$year - 2010;
			var a = value.total[year];
			switch (topDataSelection$category){
				case "total": a = value.total[year]; break;
				case "male" : a = value.male[year]; break;
				case "female" : a = value.female[year]; break;
				case "german" : a = value.german[year]; break;
				case "non_german" : a = value.non_german[year]; break;
				case "younger25" : a = value.younger25[year]; break;
			}
			var b = Math.round(255 - 255 * (a / maximum));
			color = rgbToHex(b,b,255); 
		} else {
			var startYear = topDataSelection$startingYear - 2010;
			var endYear = topDataSelection$endingYear - 2010;
			var a = value.total[year];
			switch (topDataSelection$category){
				case "total": a = value.total[endYear]/value.total[startYear]-1; break;
				case "male" : a = value.male[endYear]/value.male[startYear]-1; break;
				case "female" : a = value.female[endYear]/value.female[startYear]-1; break;
				case "german" : a = value.german[endYear]/value.german[startYear]-1; break;
				case "non_german" : a = value.non_german[endYear]/value.non_german[startYear]-1; break;
				case "younger25" : a = value.younger25[endYear]/value.younger25[startYear]-1; break;
			}
			a=a*100;
			if (a>=0){
				var b = Math.round(255 - 255 * (a / ch_maximum));
				color = rgbToHex(b,b,255); 
			} else {
				var b = Math.round(255 - 255 * (a / ch_minimum));
				color = rgbToHex(255,b,b); 
			}
		}
		return color;
	}
	
	function calculateChanges(){
		var startYear = topDataSelection$startingYear - 2010;
		var endYear = topDataSelection$endingYear - 2010;
		if (topDataSelection$districtLevel=="districts") {
			namespace=featureCollectionDistricts;
		}else{
			namespace=featureCollectionSubdistricts;
		}
		switch (topDataSelection$category){
			case "total": ch_minimum = ch_maximum = namespace.features[0].properties.total[endYear]/namespace.features[0].properties.total[startYear]-1; break;
			case "male" : ch_minimum = ch_maximum = namespace.features[0].properties.male[endYear]/namespace.features[0].properties.male[startYear]-1; break;
			case "female" : ch_minimum = ch_maximum = namespace.features[0].properties.female[endYear]/namespace.features[0].properties.female[startYear]-1; break;
			case "german" : ch_minimum = ch_maximum = namespace.features[0].properties.german[endYear]/namespace.features[0].properties.german[startYear]-1; break;
			case "non_german" : ch_minimum = ch_maximum = namespace.features[0].properties.non_german[endYear]/namespace.features[0].properties.non_german[startYear]-1; break;
			case "younger25" : ch_minimum = ch_maximum = namespace.features[0].properties.younger25[endYear]/namespace.features[0].properties.younger25[startYear]-1; break;
		}
		for (var i=1, iLen = namespace.features.length; i<iLen; i++){
			feat = namespace.features[i];
			switch (topDataSelection$category){
				case "total":
					if (ch_minimum > feat.properties.total[endYear]/feat.properties.total[startYear]-1){
						ch_minimum = feat.properties.total[endYear]/feat.properties.total[startYear]-1;
					}
					if (ch_maximum < feat.properties.total[endYear]/feat.properties.total[startYear]-1){
						ch_maximum = feat.properties.total[endYear]/feat.properties.total[startYear]-1;
					}break;
				case "male":
					if (ch_minimum > feat.properties.male[endYear]/feat.properties.male[startYear]-1){
						ch_minimum = feat.properties.male[endYear]/feat.properties.male[startYear]-1;
					}
					if (ch_maximum < feat.properties.male[endYear]/feat.properties.male[startYear]-1){
						ch_maximum = feat.properties.male[endYear]/feat.properties.male[startYear]-1;
					}break;
				case "female":  
					if (ch_minimum > feat.properties.female[endYear]/feat.properties.female[startYear]-1){
						ch_minimum = feat.properties.female[endYear]/feat.properties.female[startYear]-1;
					}
					if (ch_maximum < feat.properties.female[endYear]/feat.properties.female[startYear]-1){
						ch_maximum = feat.properties.female[endYear]/feat.properties.female[startYear]-1;
					}break;
				case "german":  
					if (ch_minimum > feat.properties.german[endYear]/feat.properties.german[startYear]-1){
						ch_minimum = feat.properties.german[endYear]/feat.properties.german[startYear]-1;
					}
					if (ch_maximum < feat.properties.german[endYear]/feat.properties.german[startYear]-1){
						ch_maximum = feat.properties.german[endYear]/feat.properties.german[startYear]-1;
					}break;
				case "non_german":  
					if (ch_minimum > feat.properties.non_german[endYear]/feat.properties.non_german[startYear]-1){
						ch_minimum = feat.properties.non_german[endYear]/feat.properties.non_german[startYear]-1;
					}
					if (ch_maximum < feat.properties.non_german[endYear]/feat.properties.non_german[startYear]-1){
						ch_maximum = feat.properties.non_german[endYear]/feat.properties.non_german[startYear]-1;
					}break;
				case "younger25":  
					if (ch_minimum > feat.properties.younger25[endYear]/feat.properties.younger25[startYear]-1){
						ch_minimum = feat.properties.younger25[endYear]/feat.properties.younger25[startYear]-1;
					}
					if (ch_maximum < feat.properties.younger25[endYear]/feat.properties.younger25[startYear]-1){
						ch_maximum = feat.properties.younger25[endYear]/feat.properties.younger25[startYear]-1;
					}break;
			}
		}
		ch_maximum = ch_maximum*100;
		ch_minimum = ch_minimum*100;
		maximum_rounded = Math.ceil(ch_maximum);
		minimum_rounded = Math.floor(ch_minimum);
		if (maximum_rounded <= 0) maximum_rounded = "-0";
		if (minimum_rounded >= 0) minimum_rounded = "-0";
		
		document.getElementById("legend-top-max").innerHTML = "+" + maximum_rounded+"%";
		document.getElementById("legend-top-mid").innerHTML = 0;
		document.getElementById("legend-top-min").innerHTML = minimum_rounded+"%";
		document.getElementById("img_legend").src = "pictures/legend_top_relative.png";
	}
	
	function calculateMaximumValue() {
		var year = topDataSelection$year - 2010;
		if (topDataSelection$districtLevel=="districts"){
			namespace = featureCollectionDistricts;
		} else {
			namespace = featureCollectionSubdistricts;
		}
		switch (topDataSelection$category){
			case "total": maximum = namespace.features[0].properties.total[year]; break;
			case "male" : maximum = namespace.features[0].properties.male[year]; break;
			case "female" : maximum = namespace.features[0].properties.female[year]; break;
			case "german" : maximum = namespace.features[0].properties.german[year]; break;
			case "non_german" : maximum = namespace.features[0].properties.non_german[year]; break;
			case "younger25" : maximum = namespace.features[0].properties.younger25[year]; break;
		}
		for (var i=1, iLen = namespace.features.length; i<iLen; i++){
			feat = namespace.features[i];
			switch (topDataSelection$category){
				case "total":
					if (maximum < feat.properties.total[year]){
						maximum = feat.properties.total[year];
					}break;
				case "male":
					if (maximum < feat.properties.male[year]){
						maximum = feat.properties.male[year];
					}break;
				case "female": 
					if (maximum < feat.properties.female[year]){
						maximum = feat.properties.female[year];
					}break;
				case "german": 
					if (maximum < feat.properties.german[year]){
						maximum = feat.properties.german[year];
					}break;
				case "non_german": 
					if (maximum < feat.properties.non_german[year]){
						maximum = feat.properties.non_german[year];
					}break;
				case "younger25": 
					if (maximum < feat.properties.younger25[year]){
						maximum = feat.properties.younger25[year];
					}break;
			}
		}
		console.log("maximum set to: "+maximum);
		var digits = maximum.toString().length;
		maximum_rounded = Math.ceil((maximum%Math.pow(10,digits-1)/Math.pow(10,digits-2)))*Math.pow(10,digits-2) + Math.floor(maximum/Math.pow(10,digits-1))*Math.pow(10,digits-1);
		console.log(maximum + " gerundet: "+ maximum_rounded);
		maximum = maximum_rounded;
		document.getElementById("legend-top-max").innerHTML = maximum_rounded;
		document.getElementById("legend-top-mid").innerHTML = "";
		document.getElementById("legend-top-min").innerHTML = 0;
		document.getElementById("img_legend").src = "pictures/legend_top_absolute.png";
	}
	
	function rand(){
		return Math.floor(Math.random()*3000);
	}
	
	colorArray = [
		[rgbToHex(255,255,255)], // index 0 never used: Color WHITE for indicating an error. Won't happen when released ;-)
		[rgbToHex(70,70,220)],
		[rgbToHex(70,220,70)],
		[rgbToHex(220,70,70)],
		[rgbToHex(250,250,0)],
		[rgbToHex(180,100,100)],
		[rgbToHex(270,10,10)],
		[rgbToHex(255,106,0)]
	]
	
	// FeatureCollection containing all districts.
	var featureCollectionDistricts = {
		"type" : "FeatureCollection",
		"properties": {
			"districtLevel": "districts"
		},
		"features": [
			
			{"type": "Feature",
			"properties": {
				"name": "Xmple District 1",
				"total": [rand(), rand(), rand(), rand(), rand()],
				"male": [rand(), rand(), rand(), rand(), rand()],
				"female": [rand(), rand(), rand(), rand(), rand()],
				"german": [rand(), rand(), rand(), rand(), rand()],
				"non_german": [rand(), rand(), rand(), rand(), rand()],
				"younger25": [rand(), rand(), rand(), rand(), rand()],
				"Color": rgbToHex(220,70,70)
			},
			"geometry": {
				"type": "Polygon", 
				"coordinates": [ [
					[ 7.639498, 51.974966 ], [ 7.595872, 51.985243 ], [ 7.594468, 51.941393 ], [ 7.60281, 51.93594 ]
				]]
			}},
			{"type": "Feature",
			"properties": {
				"name": "Xmple District 2",
				"total": [rand(), rand(), rand(), rand(), rand()],
				"male": [rand(), rand(), rand(), rand(), rand()],
				"female": [rand(), rand(), rand(), rand(), rand()],
				"german": [rand(), rand(), rand(), rand(), rand()],
				"non_german": [rand(), rand(), rand(), rand(), rand()],
				"younger25": [rand(), rand(), rand(), rand(), rand()],
				"Color": rgbToHex(250,250,0)
			},
			"geometry": {
				"type": "Polygon", 
				"coordinates": [ [
					[ 7.639498, 51.974966 ], [ 7.60281, 51.93594 ], [ 7.66281, 51.96 ], [ 7.64281, 51.98 ]
				]]
			}}
			
		]
	}
	
	// FeatureCollection containing all subdistricts.
	var featureCollectionSubdistricts = {
		"type" : "FeatureCollection",
		"properties": {
			"districtLevel": "subdistricts"	
		},
		"features": [
		
			{"type": "Feature",
			"properties": {
				"name": "Uppenberg",
				"total": [2632, 2805, 2823, 2882, 3009],
				"male": [1322, 1400, 1397, 1438, 1495],
				"female": [1310, 1405, 1426, 1444, 1514],
				"german": [2444, 2588, 2620, 2658, 2774],
				"non_german": [188, 217, 203, 224, 235],
				"younger25": [215, 307, 293, 264, 294],
				"Color": rgbToHex(70,70,220)
			},
			"geometry": {
				"type": "Polygon",
				"coordinates": [
					[ [ 7.639498, 51.974966 ], [ 7.639285, 51.974783 ], [ 7.639213, 51.974737 ], [ 7.638931, 51.974417 ], [ 7.638501, 51.974142 ], [ 7.638213, 51.974003 ], [ 7.63807, 51.973911 ], [ 7.637638, 51.97368 ], [ 7.637565, 51.973679 ], [ 7.637131, 51.973539 ], [ 7.636696, 51.973444 ], [ 7.636552, 51.973397 ], [ 7.63648, 51.973351 ], [ 7.636481, 51.973306 ], [ 7.636339, 51.973169 ], [ 7.636275, 51.972897 ], [ 7.63621, 51.972625 ], [ 7.636069, 51.972443 ], [ 7.635555, 51.972528 ], [ 7.635188, 51.972614 ], [ 7.635113, 51.972658 ], [ 7.634088, 51.972781 ], [ 7.633647, 51.972867 ], [ 7.633574, 51.972866 ], [ 7.63306, 51.97295 ], [ 7.632621, 51.97299 ], [ 7.63137, 51.973292 ], [ 7.631077, 51.973333 ], [ 7.630856, 51.973376 ], [ 7.630783, 51.973375 ], [ 7.6299, 51.97359 ], [ 7.629091, 51.973807 ], [ 7.62865, 51.973892 ], [ 7.628062, 51.97402 ], [ 7.627767, 51.974107 ], [ 7.627253, 51.974192 ], [ 7.627033, 51.974234 ], [ 7.626373, 51.974317 ], [ 7.626225, 51.97436 ], [ 7.625639, 51.974444 ], [ 7.624833, 51.974524 ], [ 7.623663, 51.974601 ], [ 7.623371, 51.974598 ], [ 7.62264, 51.974589 ], [ 7.621545, 51.974576 ], [ 7.620815, 51.974568 ], [ 7.619649, 51.974509 ], [ 7.619503, 51.974507 ], [ 7.619211, 51.974504 ], [ 7.6187, 51.974498 ], [ 7.618116, 51.974491 ], [ 7.617752, 51.974442 ], [ 7.617679, 51.974441 ], [ 7.617314, 51.974436 ], [ 7.616293, 51.974379 ], [ 7.6152, 51.974321 ], [ 7.61396, 51.974262 ], [ 7.613887, 51.974261 ], [ 7.613303, 51.974254 ], [ 7.61221, 51.974196 ], [ 7.612137, 51.974195 ], [ 7.611772, 51.974191 ], [ 7.610313, 51.974128 ], [ 7.609802, 51.974122 ], [ 7.609729, 51.974121 ], [ 7.609437, 51.974118 ], [ 7.608345, 51.974015 ], [ 7.607981, 51.973965 ], [ 7.607908, 51.973965 ], [ 7.607401, 51.973823 ], [ 7.606967, 51.973683 ], [ 7.606318, 51.973449 ], [ 7.605871, 51.973715 ], [ 7.605499, 51.973936 ], [ 7.604979, 51.974246 ], [ 7.604681, 51.974423 ], [ 7.603937, 51.974866 ], [ 7.603863, 51.97491 ], [ 7.60349, 51.975131 ], [ 7.602819, 51.975575 ], [ 7.602151, 51.975928 ], [ 7.60163, 51.976238 ], [ 7.601257, 51.976504 ], [ 7.599249, 51.977654 ], [ 7.598432, 51.978095 ], [ 7.597761, 51.978539 ], [ 7.595679, 51.979733 ], [ 7.593744, 51.980883 ], [ 7.593148, 51.981237 ], [ 7.591066, 51.982431 ], [ 7.589726, 51.983228 ], [ 7.592246, 51.984387 ], [ 7.592391, 51.984434 ], [ 7.593478, 51.984718 ], [ 7.594058, 51.98486 ], [ 7.595799, 51.985242 ], [ 7.595872, 51.985243 ], [ 7.597107, 51.985438 ], [ 7.598052, 51.985585 ], [ 7.598852, 51.985684 ], [ 7.599656, 51.985694 ], [ 7.603303, 51.985873 ], [ 7.60622, 51.985998 ], [ 7.607022, 51.986052 ], [ 7.607603, 51.986149 ], [ 7.610072, 51.98663 ], [ 7.611234, 51.986869 ], [ 7.61509, 51.987366 ], [ 7.617054, 51.987615 ], [ 7.621346, 51.988207 ], [ 7.625347, 51.98875 ], [ 7.627819, 51.98914 ], [ 7.629275, 51.989292 ], [ 7.629714, 51.989298 ], [ 7.630296, 51.98935 ], [ 7.630516, 51.989352 ], [ 7.631685, 51.989321 ], [ 7.632564, 51.98924 ], [ 7.633226, 51.989113 ], [ 7.634035, 51.988941 ], [ 7.63499, 51.988727 ], [ 7.635727, 51.98851 ], [ 7.636466, 51.988247 ], [ 7.637581, 51.987628 ], [ 7.638617, 51.987189 ], [ 7.640023, 51.986573 ], [ 7.641351, 51.986137 ], [ 7.642088, 51.98592 ], [ 7.643119, 51.985661 ], [ 7.644148, 51.985447 ], [ 7.644661, 51.985363 ], [ 7.645467, 51.985282 ], [ 7.646786, 51.985161 ], [ 7.646382, 51.984028 ], [ 7.646317, 51.983757 ], [ 7.646247, 51.983666 ], [ 7.646249, 51.983575 ], [ 7.646113, 51.983257 ], [ 7.646047, 51.983031 ], [ 7.645975, 51.982985 ], [ 7.645842, 51.982532 ], [ 7.645771, 51.982486 ], [ 7.645774, 51.982396 ], [ 7.645702, 51.98235 ], [ 7.645356, 51.981714 ], [ 7.645076, 51.981304 ], [ 7.644937, 51.981077 ], [ 7.644729, 51.980714 ], [ 7.644657, 51.980668 ], [ 7.644589, 51.980486 ], [ 7.644449, 51.980304 ], [ 7.64438, 51.980168 ], [ 7.644239, 51.979986 ], [ 7.644241, 51.979941 ], [ 7.644172, 51.979804 ], [ 7.644033, 51.979577 ], [ 7.643688, 51.978896 ], [ 7.643483, 51.978442 ], [ 7.643059, 51.977986 ], [ 7.642491, 51.977438 ], [ 7.642348, 51.977346 ], [ 7.642349, 51.977301 ], [ 7.641135, 51.976384 ], [ 7.640279, 51.975697 ], [ 7.639996, 51.975423 ], [ 7.639781, 51.975285 ], [ 7.639782, 51.97524 ], [ 7.639567, 51.975102 ], [ 7.639498, 51.974966 ], [ 7.639498, 51.974966 ] ] 
				]}
			},
			{"type": "Feature",
			"properties": {
				"name": "Aaseestadt",
				"total": [1684, 1714, 1728, 1798, 1875],
				"male": [823, 845, 812, 856, 898],
				"female": [861, 869, 916, 942, 977],
				"german": [1523, 1557, 1573, 1634, 1735],
				"non_german": [161, 157, 155, 164, 140],
				"younger25": [149, 141, 129, 156, 156],
				"Color": rgbToHex(70,220,70)
			},
			"geometry": {
				"type": "Polygon",
				"coordinates": [
					 [ [ 7.601884, 51.935206 ], [ 7.601743, 51.935069 ], [ 7.601595, 51.935113 ], [ 7.601302, 51.935154 ], [ 7.601083, 51.935152 ], [ 7.600794, 51.935058 ], [ 7.600507, 51.934919 ], [ 7.600364, 51.934827 ], [ 7.600148, 51.934734 ], [ 7.600003, 51.934688 ], [ 7.599856, 51.934731 ], [ 7.599188, 51.935084 ], [ 7.598819, 51.935215 ], [ 7.598671, 51.935304 ], [ 7.598596, 51.935348 ], [ 7.5983, 51.93548 ], [ 7.598004, 51.935612 ], [ 7.597708, 51.935744 ], [ 7.59756, 51.935832 ], [ 7.597265, 51.935919 ], [ 7.597191, 51.935963 ], [ 7.596895, 51.936095 ], [ 7.596672, 51.936228 ], [ 7.596373, 51.93645 ], [ 7.596301, 51.936449 ], [ 7.595852, 51.936805 ], [ 7.595328, 51.937205 ], [ 7.595105, 51.937338 ], [ 7.594957, 51.937426 ], [ 7.594436, 51.937736 ], [ 7.593989, 51.938047 ], [ 7.593691, 51.938224 ], [ 7.593318, 51.93849 ], [ 7.5925, 51.938977 ], [ 7.591756, 51.939419 ], [ 7.591159, 51.939864 ], [ 7.591731, 51.940232 ], [ 7.591873, 51.940369 ], [ 7.592017, 51.940416 ], [ 7.593031, 51.940653 ], [ 7.593827, 51.940889 ], [ 7.5939, 51.940889 ], [ 7.594114, 51.941027 ], [ 7.594329, 51.941165 ], [ 7.594328, 51.941211 ], [ 7.594468, 51.941393 ], [ 7.594532, 51.941664 ], [ 7.594531, 51.94171 ], [ 7.594602, 51.941756 ], [ 7.594738, 51.942073 ], [ 7.594876, 51.942346 ], [ 7.594874, 51.942391 ], [ 7.595443, 51.942894 ], [ 7.596579, 51.943901 ], [ 7.597078, 51.944268 ], [ 7.598284, 51.945366 ], [ 7.599207, 51.946189 ], [ 7.599773, 51.946783 ], [ 7.600269, 51.94724 ], [ 7.600551, 51.94756 ], [ 7.600689, 51.947832 ], [ 7.600972, 51.948106 ], [ 7.601113, 51.948289 ], [ 7.601398, 51.948518 ], [ 7.601684, 51.948702 ], [ 7.60197, 51.948886 ], [ 7.602472, 51.949162 ], [ 7.603477, 51.949716 ], [ 7.604847, 51.950274 ], [ 7.604991, 51.950321 ], [ 7.605704, 51.950871 ], [ 7.607491, 51.952066 ], [ 7.608276, 51.952662 ], [ 7.609135, 51.953214 ], [ 7.60992, 51.953765 ], [ 7.610278, 51.953995 ], [ 7.610635, 51.95427 ], [ 7.61228, 51.955372 ], [ 7.612778, 51.955785 ], [ 7.612996, 51.955832 ], [ 7.614008, 51.95616 ], [ 7.614514, 51.956302 ], [ 7.615311, 51.956492 ], [ 7.61654, 51.956867 ], [ 7.617482, 51.957104 ], [ 7.618424, 51.957341 ], [ 7.618936, 51.957301 ], [ 7.619448, 51.957262 ], [ 7.619382, 51.957036 ], [ 7.619318, 51.956764 ], [ 7.619178, 51.956537 ], [ 7.619188, 51.956221 ], [ 7.61919, 51.956176 ], [ 7.619265, 51.956087 ], [ 7.619267, 51.956041 ], [ 7.619345, 51.955862 ], [ 7.619349, 51.955726 ], [ 7.619427, 51.955592 ], [ 7.619506, 51.955367 ], [ 7.619593, 51.954917 ], [ 7.619676, 51.954602 ], [ 7.619625, 51.953879 ], [ 7.619555, 51.953788 ], [ 7.61949, 51.953516 ], [ 7.619421, 51.95338 ], [ 7.619214, 51.953016 ], [ 7.619215, 51.952971 ], [ 7.619007, 51.952608 ], [ 7.618936, 51.952562 ], [ 7.618937, 51.952517 ], [ 7.618724, 51.952333 ], [ 7.618513, 51.95206 ], [ 7.617741, 51.951058 ], [ 7.617672, 51.950922 ], [ 7.6176, 51.950876 ], [ 7.616685, 51.949782 ], [ 7.616334, 51.949326 ], [ 7.616121, 51.949143 ], [ 7.615348, 51.948186 ], [ 7.614996, 51.947776 ], [ 7.614924, 51.94773 ], [ 7.614785, 51.947502 ], [ 7.614081, 51.946681 ], [ 7.61373, 51.946226 ], [ 7.613658, 51.94618 ], [ 7.61366, 51.946135 ], [ 7.612604, 51.944858 ], [ 7.612464, 51.944676 ], [ 7.611832, 51.943856 ], [ 7.611619, 51.943673 ], [ 7.611409, 51.943399 ], [ 7.610916, 51.942807 ], [ 7.610353, 51.942123 ], [ 7.610282, 51.942077 ], [ 7.610283, 51.942032 ], [ 7.610143, 51.94185 ], [ 7.610071, 51.941804 ], [ 7.609791, 51.941439 ], [ 7.609579, 51.941211 ], [ 7.609156, 51.94071 ], [ 7.608592, 51.940071 ], [ 7.608452, 51.939889 ], [ 7.60803, 51.939387 ], [ 7.607461, 51.938884 ], [ 7.607105, 51.938609 ], [ 7.607032, 51.938608 ], [ 7.605885, 51.937962 ], [ 7.605454, 51.937732 ], [ 7.604739, 51.937272 ], [ 7.604523, 51.937179 ], [ 7.604095, 51.936858 ], [ 7.603952, 51.936766 ], [ 7.603737, 51.936628 ], [ 7.603381, 51.936353 ], [ 7.60281, 51.93594 ], [ 7.602384, 51.935574 ], [ 7.601884, 51.935206 ], [ 7.601884, 51.935206 ] ]
				]}
			}
				
		]
	}
	
	geojsonLayer = L.geoJson(featureCollectionDistricts, {
		style: function(Feature) {
				return {
						color: 'white',
						weight: 2,
						fillColor: getColor(Feature.properties),
						dashArray: '3',
						opacity: 0.8,
						fillOpacity: 0.5
					};
				}
	});
	
	function drawTopMapLayer(){
		if (!drawnFirstTime) {
			map.removeLayer(geojsonLayer);
		}
		if (topDataSelection$districtLevel=="districts"){
			geojsonLayer = L.geoJson(featureCollectionDistricts, {
				style: function(Feature) {
					return {
							color: 'white',
							weight: 2,
							fillColor: window["getColor"](Feature.properties),
							dashArray: '3',
							opacity: 0.8,
							fillOpacity: 0.7
						};
					},
					onEachFeature: onEachFeature
				}
			);
		} else {
			geojsonLayer = L.geoJson(featureCollectionSubdistricts, {
				style: function(Feature) {
					return {
							color: 'white',
							weight: 2,
							fillColor: window["getColor"](Feature.properties),
							dashArray: '3',
							opacity: 0.8,
							fillOpacity: 0.7
						};
					},
					onEachFeature: onEachFeature
				}
			);
		}
		geojsonLayer.addTo(map);
		drawnFirstTime = false;
	}
	
	function highlightFeature(e) {
		var layer = e.target;
	
		layer.setStyle({
			weight: 5,
			color: '#666',
			dashArray: '',
			fillOpacity: 0.7
		});
		
		info.update(layer.feature.properties);
	}
	
	function resetHighlight(e) {
		geojsonLayer.resetStyle(e.target);
		info.update();
	}
	
	function zoomToFeature(e) {
		map.fitBounds(e.target.getBounds());
	}
	
	function onEachFeature(feature, layer) {
		layer.on({
			mouseover: highlightFeature,
			mouseout: resetHighlight,
			click: zoomToFeature
		});
	}
	
	function updateChart(){
		console.log("updating Linechart...");
		delete data.datasets;
		data.datasets = [];
		if (botDataSelection$districtLevel=="districts"){
			for (var i=0, iLen = featureCollectionDistricts.features.length; i<iLen; i++){
				feat = featureCollectionDistricts.features[i];
				for (var j=0, jLen = botDataSelection$comparedDistricts.length; j<jLen; j++){
					name = botDataSelection$comparedDistricts[j];
					if (name==feat.properties.name) {
						switch (botDataSelection$category){
							case "total":
								category = feat.properties.total; break;
							case "male":
								category = feat.properties.male; break;
							case "female":
								category = feat.properties.female; break;
							case "german":
								category = feat.properties.german; break;
							case "non_german":
								category = feat.properties.non_german; break;
							case "younger25":
								category = feat.properties.younger25; break;
						}
						data.datasets.push( {
							label: name,
							fill: false,
							backgroundColor: feat.properties.Color,
							borderColor:  feat.properties.Color,
							pointBorderColor: feat.properties.Color,
							pointBackgroundColor: "#fff",
							pointBorderWidth: 1,
							pointHoverRadius: 5,
							pointHoverBackgroundColor: feat.properties.Color,
							pointHoverBorderColor: feat.properties.Color,
							pointHoverBorderWidth: 2,
							data: category
						})
					}
				}
			}
		} else {
			for (var i=0, iLen = featureCollectionSubdistricts.features.length; i<iLen; i++){
				feat = featureCollectionSubdistricts.features[i];
				for (var j=0, jLen = botDataSelection$comparedSubdistricts.length; j<jLen; j++){
					name = botDataSelection$comparedSubdistricts[j];
					if (name==feat.properties.name) {
						switch (botDataSelection$category){
							case "total":
								category = feat.properties.total; break;
							case "male":
								category = feat.properties.male; break;
							case "female":
								category = feat.properties.female; break;
							case "german":
								category = feat.properties.german; break;
							case "non_german":
								category = feat.properties.non_german; break;
							case "younger25":
								category = feat.properties.younger25; break;
						}
						data.datasets.push( {
							label: name,
							fill: false,
							backgroundColor: feat.properties.Color,
							borderColor:  feat.properties.Color,
							pointBorderColor: feat.properties.Color,
							pointBackgroundColor: "#fff",
							pointBorderWidth: 1,
							pointHoverRadius: 5,
							pointHoverBackgroundColor: feat.properties.Color,
							pointHoverBorderColor: feat.properties.Color,
							pointHoverBorderWidth: 2,
							data: category
						})
					}
				}
			}
		}
		// Get the context of the canvas element we want to select
		var ctx = document.getElementById("myChart").getContext("2d");
		var myLineChart = new Chart(ctx, { type: 'line', data:data, options: {}});
		document.getElementById("legend").innerHTML = myLineChart.generateLegend();
	}
	
	drawnFirstTimeBot = true;	
	
	function getSelectionColor(district){
		var name = district.properties.name;
		if (botDataSelection$districtLevel=="districts"){
			for (var i=0, iLen = botDataSelection$comparedDistricts.length; i<iLen; i++){
				var sel_dis = botDataSelection$comparedDistricts[i];
				if (name==sel_dis){
					return district.properties.Color;}
			}
		} else {
			for (var i=0, iLen = botDataSelection$comparedSubdistricts.length; i<iLen; i++){
				var sel_dis = botDataSelection$comparedSubdistricts[i];
				if (name==sel_dis){
					return district.properties.Color;}
			}
		}
		return rgbToHex(125,180,180);
	}
	
	geojsonLayerBot = L.geoJson(featureCollectionDistricts, {
		style: function(Feature) {
				return {
						color: 'white',
						weight: 2,
						fillColor: getSelectionColor(Feature),
						dashArray: '3',
						opacity: 0.8,
						fillOpacity: 0.5
					};
				}
	});
	
	function selectDistrict(e) {
		var layer = e.target;
		var district = layer.feature;
		console.log(layer.feature.properties.name);
		if (botDataSelection$districtLevel=="districts") { 
			namespace = botDataSelection$comparedDistricts;
			var optionlist = document.getElementById('sel_botDistricts'); }
		else { 
			namespace = botDataSelection$comparedSubdistricts
			var optionlist = document.getElementById('sel_botSubdistricts'); }
		
		var districtWasSelected = false;
		for (var i=0, iLen = namespace.length; i<iLen; i++){
			if (district.properties.name == namespace[i]){
				namespace.splice(i,1);
				districtWasSelected = true;
				// unselect it in Selector as well
				for (var option = 0; option < optionlist.length; option++ ){
					if (optionlist[option].text == district.properties.name){
						optionlist[option].selected = false;
						break;
					}
				}
			}
		}
		if (!districtWasSelected) {
			namespace.push(district.properties.name);
			// select it in Selector as well
			for (var option = 0; option < optionlist.length; option++ ){
				if (optionlist[option].text == district.properties.name){
					optionlist[option].selected = true;
					break;
				}
			}
		}
		updateBotMap();
	}
	
	function onEachFeatureBot(feature, layer) {
		layer.on({
			click: selectDistrict
		});
	}
	
	function drawBotMapLayer(){
		if (!drawnFirstTimeBot) {
			map_bottom.removeLayer(geojsonLayerBot);
		}
		if (botDataSelection$districtLevel=="districts"){
			geojsonLayerBot = L.geoJson(featureCollectionDistricts, {
				style: function(Feature) {
					return {
							color: 'white',
							weight: 2,
							fillColor: getSelectionColor(Feature),
							dashArray: '3',
							opacity: 0.8,
							fillOpacity: 0.7
						};
					},
					onEachFeature: onEachFeatureBot
				}
			);
		} else {
			geojsonLayerBot = L.geoJson(featureCollectionSubdistricts, {
				style: function(Feature) {
					return {
							color: 'white',
							weight: 2,
							fillColor: getSelectionColor(Feature),
							dashArray: '3',
							opacity: 0.8,
							fillOpacity: 0.7
						};
					},
					onEachFeature: onEachFeatureBot
				}
			);
		}
		geojsonLayerBot.addTo(map_bottom);
		drawnFirstTimeBot = false;
	}
	
	
	$("#timeContainerRelative").hide();
	$("#sel_subdis").hide();
	
</script>


</html>